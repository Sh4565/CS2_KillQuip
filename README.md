
<h1 align="center">KillQuip</h1>

---

Удивите своих друзей остроумной фразой в чате после каждого удачного выстрела!


### ВНИМАНИЕ!
**Данный скрипт не рекомендуется использовать на официальных серверах или на серверах, 
где включена система VAC.**  
Разработчик не несёт ответственности за блокировку аккаунтов и любые другие 
последствия. Используйте на свой страх и риск.


## Содержание
- [Технологии](#технологии)
- [Демонстрация](#демонстрация)
- [Как это работает?](#как-это-работает)
- [Установка](#установка)
  - [Компиляция](#компиляция)
  - [Установка пакета](#установка-пакета)
- [Настройка](#настройка)
- [Использование](#Использование)


## Технологии
- [OpenCV](https://opencv.org)
- [NumPy](https://numpy.org)
- [Nuitka](https://nuitka.net)


## Демонстрация
![GIF1](https://github.com/Sh4565/Xlams/blob/main/KillQuip/1.gif?raw=true)
![GIF2](https://github.com/Sh4565/Xlams/blob/main/KillQuip/2.gif?raw=true)


## Как это работает?
Я долго искал нечто похожее на API для движка Source2.  
Но в конце концов пришёл к выводу, что без "костылей" не обойтись, так как команды, 
которая выдаёт статистику об убийствах в матче, не существует.

Поэтому я использовал библиотеку OpenCV2, чтобы находить информацию об убийствах 
в правом верхнем углу экрана.

![GIF3](https://github.com/Sh4565/Xlams/blob/main/KillQuip/3.gif?raw=true)

Скрипт в выделенной области ищет сообщения в красной рамке, которые появляются тогда, когда игрок совершает убийство (или помогает в убийстве).

Если условие выполнено, то в корневой директории игры создаётся конфигурационный файл `quip.cfg` с такой командой:

```commandline
say {text}
```
Где вместо `{text}` подставляется случайная фраза из заранее записанных.

После этого скрипт автоматически нажимает клавишу, загружает конфигурационный 
файл `quip.cfg` и отправляет сообщение в общий чат. Для корректной работы скрипт 
ожидает 8,5 секунд.


## Установка
#### 1. Клонируем репозиторий
```commandline
git clone https://github.com/Sh4565/KillQuip.git
```

#### 2. Создаем переменные окружения
```commandline
python -m venv venv
```

#### 3. Активируем переменные окружения
```commandline
.\venv\Scripts\activate
```

#### 4. Устанавливаем зависимости
```commandline
pip install -r .\requirements.txt
```

### Компиляция
В данном проекте используется программа [Nuitka](https://nuitka.net), 
которая конвертирует Python-код в C++ и затем компилирует его.
Я использую компилятор [MinGW64 v12.3](https://objects.githubusercontent.com/github-production-release-asset-2e65be/220996547/86825ef3-e192-47cb-a35b-6534c686ac07?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=releaseassetproduction%2F20240803%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20240803T124102Z&X-Amz-Expires=300&X-Amz-Signature=27bcd64354dac92c70216813768d49896ab4dd45b5a1daa4c3e694120fcdae69&X-Amz-SignedHeaders=host&actor_id=77664190&key_id=0&repo_id=220996547&response-content-disposition=attachment%3B%20filename%3Dwinlibs-x86_64-posix-seh-gcc-12.3.0-llvm-16.0.4-mingw-w64ucrt-11.0.0-r1.7z&response-content-type=application%2Foctet-stream), который можно скачать с 
официального сайта.

Перед компиляцией нужно создать временную директорию (например, `temp`), в 
которую надо скопировать каталог `src`, а также файлы `errors.log` и 
`settings.cfg`.

Затем введите следующую команду для компиляции:
```commandline
python -m nuitka --standalone --mingw64 --include-data-file=./errors.log=errors.log --include-data-file=./settings.cfg=settings.cfg KillQuip.py
```

#### Возможная ошибка при компиляции
Если при компиляции возникает ошибка `UnicodeDecodeError`, это может быть 
связано с тем, что один из файлов проекта имеет нестандартное кодирование 
или специфичное название, например `.gitignore` или `.ide`. 
В таком случае следует удалить файлы, созданные Nuitka, и повторить процедуру 
компиляции.

##### Пример ошибки:
```commandline
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xcf in position 1034796: invalid continuation byte
Nuitka-Reports: Compilation crash report written to file 'nuitka-crash-report.xml'. Please include
Nuitka-Reports: it in your bug report.
```


### Установка пакета
Установите пакет:
```commandline
python setup.py install
```
После установки можно запустить программу, введя команду:
```commandline
kill-quip
```
или
```commandline
kq
```
При первом запуске появится ошибка `FileNotFoundError` сгенерирует 
конфигурационный файл с дефолтными настройками. 


## Настройка

Перед использованием необходимо настроить скрипт с помощью следующих команд:

### - Выделить область в котором выводятся сообщения 
```shell
python.exe .\KillQuip.py -sa
```

Данный скрипт позволяет обозначить область отслеживания сообщений.
Для этого я использую программу Snip & Sketch (установленную по умолчанию), 
с помощью которой создаются скриншоты области.

![GIF4](https://github.com/Sh4565/Xlams/blob/main/KillQuip/4.gif?raw=true)


### - Установить путь к корневой директории игры.
```shell
python.exe .\KillQuip.py -p
```
Введите путь к директории вручную или скопируйте его:


```shell
python.exe .\KillQuip.py -p "{path}"
```
Где вместо `{path}` подставляется путь к директории. Обратите внимание, что путь 
лучше всего вводить в кавычках, так как пробелы или другие символы могут быть 
неправильно интерпретированы.


### - Добавление фраз.
```shell
python.exe .\KillQuip.py -m
```
После ввода этой команды запускается скрипт, который последовательно записывает 
введённые фразы.
Чтобы завершить ввод, просто нажмите клавишу Enter, оставив строку пустой.


### - Настройка игры.
Откройте консоль разработчика в CS2 и введите команду:
```commandline
bind "p" "exec quip"
```
Эта команда позволяет скрипту автоматически нажимать клавишу `"p"` и отправлять 
заготовленную фразу в чат.

## Использование
Перед началом матча или во время него запустите скрипт: 
```shell
python.exe .\KillQuip.py
```
Затем начинайте играть, а скрипт будет автоматически отправлять забавные фразы 
в чат после каждого убийства.